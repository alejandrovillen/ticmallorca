<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 11. JBossWS-Recordsmanagement</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="JBossWS-CXF Guide"/><link rel="up" href="Additional documentation.html" title="Part II. Additional documentation"/><link rel="prev" href="chap_JBossWS-Endpointmanagement.html" title="Chapter 10. JBossWS-Endpointmanagement"/><link rel="next" href="Samples, Tutorials, references.html" title="Part III. Samples &amp; Tutorials"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="chap_JBossWS-Endpointmanagement.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="Samples, Tutorials, references.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="chap_JBossWS-Recordsmanagement"/>Chapter 11. JBossWS-Recordsmanagement</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_What_is_recorded">11.1. What is recorded</a></span></dt><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Use_cases">11.2. Use cases</a></span></dt><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_How_it_works_and_how_to_use_it">11.3. How it works and how to use it</a></span></dt><dd><dl><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Server_side">11.3.1. Server side</a></span></dt><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Client_side">11.3.2. Client side</a></span></dt></dl></dd><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Advanced_hints">11.4. Advanced hints</a></span></dt><dd><dl><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Adding_custom_recorders">11.4.1. Adding custom recorders</a></span></dt><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Handlers_position">11.4.2. Handler's position</a></span></dt><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Multiple_handlers">11.4.3. Multiple handlers</a></span></dt></dl></dd><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Future_extensions">11.5. Future extensions</a></span></dt><dd><dl><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Database_recorder">11.5.1. Database recorder</a></span></dt><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_Custom_log_writer">11.5.2. Custom log writer</a></span></dt></dl></dd><dt><span class="section"><a href="chap_JBossWS-Recordsmanagement.html#JBossWS-Recordsmanagement_References">11.6. References</a></span></dt></dl></div><p>JBossWS records' collection and management system gives administrators a means of performing custom analysis of their webservice traffic as well as exporting communication logs.</p><p/><p> </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBossWS-Recordsmanagement_What_is_recorded"/>11.1. What is recorded</h2></div></div></div><p>Each record is basically composed of a message plus additional information; here are the current record attributes:</p><div class="itemizedlist"><ul><li><p> Creation date </p></li><li><p> Source host </p></li><li><p> Destination host </p></li><li><p> Message type (in/out) </p></li><li><p> Invoked endpoint operation </p></li><li><p> Message envelope (including both soap:header and soap:body for SOAP messages) </p></li><li><p> Http headers </p></li><li><p> Record group ID (allowing records belonging to the same message flow to be linked together) </p></li></ul></div><p>Of course records may also have meaningful values for a subset of the afore mentioned record attributes.</p><p> </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBossWS-Recordsmanagement_Use_cases"/>11.2. Use cases</h2></div></div></div><p>What are records useful for? In spite of <a href="chap_JBossWS-Endpointmanagement.html" title="Chapter 10. JBossWS-Endpointmanagement">endpoint metrics</a> that provide response time information and counts of invocations, records provide users with rich data about the content of the exchanged messages and their sender/receiver. The record system allows fine grained management and is customizable according to the users need; some of the use cases supported by the default configuration are:</p><div class="itemizedlist"><ul><li><p> Logging request and response messages: being able to record messages received from and sent to a given service consumer without stopping the provider may be really useful. You just need to set the <span class="emphasis"><em>recording</em></span> attribute of their endpoint's LogRecorder to true. The added value of this logging solution comes from the use of filters through which messages coming from a given address and related to a given wsdl operation only can be logged. </p></li><li><p> Accountability: service providers may want to know which consumers are actually hitting a given service. This can be done for example using the <span class="emphasis"><em>getClientHosts</em></span> functionality of the MemoryBufferRecorder once it has been switched to recording state. </p></li><li><p> Getting statistics, filtering records: service administrators might want to see the last records related to a given endpoint or operation, the last records related to messages coming from a given customer and the response the system gave them, etc. These information can be obtained using the <span class="emphasis"><em>getRecordsByOperation</em></span>, <span class="emphasis"><em>getRecordsByClientHost</em></span> or the more general <span class="emphasis"><em>getMatchingRecords</em></span> functionality of the MemoryBufferRecorder.</p></li></ul></div><p> </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBossWS-Recordsmanagement_How_it_works_and_how_to_use_it"/>11.3. How it works and how to use it</h2></div></div></div><p>The recording system is composed of</p><div class="itemizedlist"><ul><li><p> JAX-WS handlers intercepting inbound and outbound communication </p></li><li><p> Record processors plugged into deployed endpoints; handlers collect records and send them to every processors through the current endpoint. Processors may store records, convert them, log them, ... </p></li><li><p> MBean views of processors that can be used to configure and fine tune recording at runtime </p></li><li><p> Record filters allowing selection of information to be recorded as well as providing means of performing custom queries on the saved records.</p></li></ul></div><p> </p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JBossWS-Recordsmanagement_Server_side"/>11.3.1. Server side</h3></div></div></div><p>On server side records are collected by JAX-WS handlers and passed to the configured processors. JBossWS comes with two default record processors that are plugged into every endpoint during the deployment:</p><div class="itemizedlist"><ul><li><p> LogRecorder: a simple record processor that writes records to the configured log. </p></li><li><p> MemoryBufferRecorder: a record processor that keeps the last received records in memory and allows user to search / get statistics on them. </p></li></ul></div><p>Every processors can be fine tuned to process some record attributes only according to the user and/or performance requirements. Default processors are not in recording mode upon creation, thus you need to switch them to recording mode through their MBean interfaces (see the <span class="emphasis"><em>Recording</em></span> flag in the jmx-console).</p><p>Common processor properties and their respective defaults values are:</p><div class="itemizedlist"><ul><li><p> processDestinationHost (true) </p></li><li><p> processSourceHost (true) </p></li><li><p> processHeaders (true) </p></li><li><p> processEnvelope (true) </p></li><li><p> processMessageType (true) </p></li><li><p> processOperation (true) </p></li><li><p> processDate (true) </p></li><li><p> recording (false) </p></li></ul></div><p>The recorders can be configured in the stacks bean configuration</p><pre class="screen">  &lt;!-- Installed Record Processors--&gt;
  &lt;bean name="WSMemoryBufferRecorder" class="org.jboss.wsf.framework.management.recording.MemoryBufferRecorder"&gt;
    &lt;property name="recording"&gt;false&lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean name="WSLogRecorder" class="org.jboss.wsf.framework.management.recording.LogRecorder"&gt;
    &lt;property name="recording"&gt;false&lt;/property&gt;
  &lt;/bean&gt;
</pre><p>The recording system is available for all the JBossWS supported stacks. However slightly different procedure is required to enable it depending on the used stack.</p><div class="variablelist"><dl><dt><span class="term"><span class="bold"><strong>Native stack</strong></span> </span></dt><dd/></dl></div><p>Native stack comes with <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://community.jboss.org/docs/DOC-13512">JBossWS - JAX-WS Endpoint Configuration</a>. The default standard endpoint already has the server side recording handler:</p><pre class="screen">  &lt;endpoint-config&gt;
    &lt;config-name&gt;Standard Endpoint&lt;/config-name&gt;
    &lt;pre-handler-chains&gt;
      &lt;javaee:handler-chain&gt;
        &lt;javaee:protocol-bindings&gt;##SOAP11_HTTP&lt;/javaee:protocol-bindings&gt;
        &lt;javaee:handler&gt;
          &lt;javaee:handler-name&gt;Recording Handler&lt;/javaee:handler-name&gt;
          &lt;javaee:handler-class&gt;org.jboss.wsf.framework.invocation.RecordingServerHandler&lt;/javaee:handler-class&gt;
        &lt;/javaee:handler&gt;
      &lt;/javaee:handler-chain&gt;
    &lt;/pre-handler-chains&gt;
  &lt;/endpoint-config&gt;
</pre><p>thus nothing is required to use it since it is automatically installed in the pre-handler-chain. Of course you might want to add it to other endpoint configurations you're using.</p><div class="variablelist"><dl><dt><span class="term"><span class="bold"><strong>Metro and CXF stacks </strong></span></span></dt><dd/></dl></div><p>Other stacks require users to manually add the <span class="emphasis"><em>org.jboss.wsf.framework.invocation.RecordingServerHandler</em></span> to their endpoint handler chain. This can be done <a href="chap_JBossWS-UserGuide.html" title="Chapter 2. JBossWS-UserGuide">the same way common user handlers are added</a>.</p><p>Once the handler is properly added to the chain, log recording configuration is agnostic to the used stack. Users just need to tune the processors parameters though their MBean interfaces.</p><p> </p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JBossWS-Recordsmanagement_Client_side"/>11.3.2. Client side</h3></div></div></div><p>JMX management of processors is of course available on server side only. However users might also be interested in collecting and processing records on client side. Since handlers can be set on client side too, customer handlers could be configured to capture messages almost like the <span class="emphasis"><em>RecordingServerHandler</em></span> does. This is left to the users since it is directly linked to their custom needs. For instance a common use could be to pass client side collected records to the LogRecorder.</p><p> </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBossWS-Recordsmanagement_Advanced_hints"/>11.4. Advanced hints</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JBossWS-Recordsmanagement_Adding_custom_recorders"/>11.4.1. Adding custom recorders</h3></div></div></div><p>As previously said, the recording system is extensible: JBossWS users can write their own processors and plug them at runtime into their deployed endpoints through the <span class="emphasis"><em>addRecordProcessor</em></span> functionality of the ManagedEndpoint MBean. Every processor needs to implement the <span class="emphasis"><em>org.jboss.wsf.spi.management.recording.RecordProcessor</em></span> interface. Then you can choose one of the two following options:</p><div class="itemizedlist"><ul><li><p> Give you record processor an MBean interface declaring the manageable attributes: the recording system will plug your processor to the endpoint and register a management MBean for it using your interface. This allows you to create highly configurable custom processors. For an example of this development option, take a look at the <span class="emphasis"><em>org.jboss.wsf.framework.management.recording.MemoryBufferRecorder</em></span>. </p></li><li><p> Add your record processor to the managed endpoint as is: the recording system will plug it to the endpoint and register a standard management MBean for its basic processing configuration. The <span class="emphasis"><em>org.jboss.wsf.framework.management.recording.LogRecorder</em></span> is an example of this development option. </p></li></ul></div><p>A code snippet showing how to get the MBeanProxy instance which you can invoke MBean with can be found <a href="chap_JBossWS-Endpointmanagement.html" title="Chapter 10. JBossWS-Endpointmanagement">here</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JBossWS-Recordsmanagement_Handlers_position"/>11.4.2. Handler's position</h3></div></div></div><p>Of course the recording handler's position in the handler chain influences the collected records. As a matter of fact some information may or may not be available at a given point of the handler chain execution. The standard endpoint configuration declares the RecordingServerHandler into the pre-handler-chain. Speaking of the native stack, this means for example that you'll get the invoked operation data and that decrypted messages will be recorded if using WS-Security, since the WS-Security handler runs in the post-handler-chain. Users might want to change the recording handler's position in the chain according to their requirements.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JBossWS-Recordsmanagement_Multiple_handlers"/>11.4.3. Multiple handlers</h3></div></div></div><p>Records attributes include a record group ID that is meant to link records whose messages belong to the same message flow (a request-response for example). In order to set the right group ID to the records, the current ID is associated to the thread that is processing the endpoint invocation. This means that multiple related records can be linked together and extracted together from a processor.</p><p>For this reason, you might want to install multiple recording handlers into different points of the handler chain. For instance, it could make sense to record messages both before and after encryption/decryption when using WS-Security.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBossWS-Recordsmanagement_Future_extensions"/>11.5. Future extensions</h2></div></div></div><p>This paragraph covers eventual future extensions and/or idea JBossWS users may want to leverage for their own business.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JBossWS-Recordsmanagement_Database_recorder"/>11.5.1. Database recorder</h3></div></div></div><p>The MemoryBufferRecorder provides interesting functionalities to query the collected records set. For obvious reasons, records are discarded once a given size of the buffer is reached.</p><p>A DB based recorder could be developed; it should work the same way the MemoryBufferRecorder does, except for records that should be saved through a given datasource. This will provide persistence of data even in case of application server reboot and webservice application redeploy. It will also allow records coming from different node of a cluster to be stored together. Finally this would allow administrators to directly query the database, which might be far more efficient.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JBossWS-Recordsmanagement_Custom_log_writer"/>11.5.2. Custom log writer</h3></div></div></div><p>The idea of getting statistics from collected records could be further exploited getting custom logs from the records. These logs could be outputted by a custom processor in standard or proprietary formats allowing them to be imported into eventual third-party log processing tools which might offer complex/funky graphic or statistic functionalities and so on.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBossWS-Recordsmanagement_References"/>11.6. References</h2></div></div></div><p>You might want to take a look at the <span class="emphasis"><em>org.jboss.wsf.framework.management.recording</em></span> and <span class="emphasis"><em>org.jboss.wsf.spi.management.recording</em></span> packages in the source code to better understand how all this works and can be used.</p></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="chap_JBossWS-Endpointmanagement.html"><strong>Prev</strong>Chapter 10. JBossWS-Endpointmanagement</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="Samples, Tutorials, references.html"><strong>Next</strong>Part III. Samples &amp; Tutorials</a></li></ul></body></html>